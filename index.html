<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Fabalicious Documentation">
  <meta name="author" content="Factorial GmbH, Hamburg">
  <link rel="shortcut icon" href="./img/favicon.ico">
  <title>Home - Fabalicious</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="./css/theme.css" type="text/css" />
  <link rel="stylesheet" href="./css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="./css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Home";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = "/";
  </script>
  
  <script src="./js/jquery-2.1.1.min.js"></script>
  <script src="./js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="./js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> Fabalicious</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href=".">Home</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#how-does-fabalicious-work-in-two-sentences">How does fabalicious work in two sentences</a></li>
                
            
                <li class="toctree-l3"><a href="#table-of-contents">Table of Contents</a></li>
                
            
                <li class="toctree-l3"><a href="#installation-of-needed-dependencies">Installation of needed dependencies</a></li>
                
            
                <li class="toctree-l3"><a href="#installation-of-fabalicious">Installation of fabalicious</a></li>
                
            
                <li class="toctree-l3"><a href="#a-simple-configuration-example">A simple configuration-example</a></li>
                
            
                <li class="toctree-l3"><a href="#running-fabalicious">Running fabalicious</a></li>
                
            
                <li class="toctree-l3"><a href="#tasks">Tasks</a></li>
                
                    <li><a class="toctree-l4" href="#some-background">Some Background</a></li>
                
                    <li><a class="toctree-l4" href="#list-of-available-tasks">List of available tasks</a></li>
                
                    <li><a class="toctree-l4" href="#config">config</a></li>
                
                    <li><a class="toctree-l4" href="#list">list</a></li>
                
                    <li><a class="toctree-l4" href="#about">about</a></li>
                
                    <li><a class="toctree-l4" href="#blueprint">blueprint</a></li>
                
                    <li><a class="toctree-l4" href="#doctor">doctor</a></li>
                
                    <li><a class="toctree-l4" href="#getproperty">getProperty</a></li>
                
                    <li><a class="toctree-l4" href="#version">version</a></li>
                
                    <li><a class="toctree-l4" href="#deploy">deploy</a></li>
                
                    <li><a class="toctree-l4" href="#reset">reset</a></li>
                
                    <li><a class="toctree-l4" href="#backup">backup</a></li>
                
                    <li><a class="toctree-l4" href="#backupdb">backupDB</a></li>
                
                    <li><a class="toctree-l4" href="#listbackups">listBackups</a></li>
                
                    <li><a class="toctree-l4" href="#restore">restore</a></li>
                
                    <li><a class="toctree-l4" href="#getbackup">getBackup</a></li>
                
                    <li><a class="toctree-l4" href="#copyfrom">copyFrom</a></li>
                
                    <li><a class="toctree-l4" href="#copydbfrom">copyDBFrom</a></li>
                
                    <li><a class="toctree-l4" href="#copyfilesfrom">copyFilesFrom</a></li>
                
                    <li><a class="toctree-l4" href="#drush">drush</a></li>
                
                    <li><a class="toctree-l4" href="#drupalconsole">drupalconsole</a></li>
                
                    <li><a class="toctree-l4" href="#getfile">getFile</a></li>
                
                    <li><a class="toctree-l4" href="#putfile">putFile</a></li>
                
                    <li><a class="toctree-l4" href="#getsqldump">getSQLDump</a></li>
                
                    <li><a class="toctree-l4" href="#restoresqlfromfile">restoreSQLFromFile</a></li>
                
                    <li><a class="toctree-l4" href="#script">script</a></li>
                
                    <li><a class="toctree-l4" href="#docker">docker</a></li>
                
            
                <li class="toctree-l3"><a href="#the-structure-of-the-configuration-file">the structure of the configuration file</a></li>
                
                    <li><a class="toctree-l4" href="#overview">Overview</a></li>
                
                    <li><a class="toctree-l4" href="#inheritance">Inheritance</a></li>
                
            
                <li class="toctree-l3"><a href="#scripts_1">Scripts</a></li>
                
                    <li><a class="toctree-l4" href="#replacement-patterns">Replacement-patterns</a></li>
                
                    <li><a class="toctree-l4" href="#internal-commands">Internal commands</a></li>
                
                    <li><a class="toctree-l4" href="#task-related-scripts">Task-related scripts</a></li>
                
                    <li><a class="toctree-l4" href="#examples">Examples</a></li>
                
            
                <li class="toctree-l3"><a href="#docker-integration">Docker integration</a></li>
                
            
                <li class="toctree-l3"><a href="#local-overrides">Local overrides</a></li>
                
            
            </ul>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">Fabalicious</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>Home</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/factorial-io/fabalicious/edit/develop/docs/docs/index.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="how-does-fabalicious-work-in-two-sentences">How does fabalicious work in two sentences</h1>
<p>Fabalicious uses a configuration file with a list of hosts and <code>ssh</code> and optionally tools like <code>composer</code>, <code>drush</code>, <code>git</code>, <code>docker</code> or custom scripts to run common tasks on remote machines. It is slightly biased to drupal-projects but it works for a lot of other types of projects.</p>
<p>Fabalicious is using <a href="http://www.fabfile.org">fabric</a> to run tasks on remote machines. The configuration-file contains a list of hosts to work on. Some common tasks are:</p>
<ul>
<li>deploying new code to a remote installation</li>
<li>reset a remote installation to its defaults.</li>
<li>backup/ restore data</li>
<li>copy data from one installation to another</li>
<li>optionally work with our docker-based development-stack <a href="https://github.com/factorial-io/multibasebox">multibasebox</a></li>
</ul>
<h1 id="table-of-contents">Table of Contents</h1>
<ul>
<li><a href="#how-does-fabalicious-work-in-two-sentences">How does fabalicious work in two sentences</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#installation-of-needed-dependencies">Installation of needed dependencies</a></li>
<li><a href="#installation-of-fabalicious">Installation of fabalicious</a></li>
<li><a href="#a-simple-configuration-example">A simple configuration-example</a></li>
<li><a href="#running-fabalicious">Running fabalicious</a></li>
<li><a href="#tasks">Tasks</a><ul>
<li><a href="#some-background">Some Background</a></li>
<li><a href="#list-of-available-tasks">List of available tasks</a></li>
<li><a href="#config">config</a></li>
<li><a href="#list">list</a></li>
<li><a href="#about">about</a></li>
<li><a href="#blueprint">blueprint</a></li>
<li><a href="#doctor">doctor</a></li>
<li><a href="#getproperty">getProperty</a></li>
<li><a href="#version">version</a></li>
<li><a href="#deploy">deploy</a></li>
<li><a href="#reset">reset</a></li>
<li><a href="#backup">backup</a></li>
<li><a href="#backupdb">backupDB</a></li>
<li><a href="#listbackups">listBackups</a></li>
<li><a href="#restore">restore</a></li>
<li><a href="#getbackup">getBackup</a></li>
<li><a href="#copyfrom">copyFrom</a></li>
<li><a href="#copydbfrom">copyDBFrom</a></li>
<li><a href="#copyfilesfrom">copyFilesFrom</a></li>
<li><a href="#drush">drush</a></li>
<li><a href="#drupalconsole">drupalconsole</a></li>
<li><a href="#getfile">getFile</a></li>
<li><a href="#putfile">putFile</a></li>
<li><a href="#getsqldump">getSQLDump</a></li>
<li><a href="#restoresqlfromfile">restoreSQLFromFile</a></li>
<li><a href="#script">script</a></li>
<li><a href="#docker">docker</a></li>
<li><a href="#copysshkeys">copySSHKeys</a></li>
<li><a href="#startremoteaccess">startRemoteAccess</a></li>
<li><a href="#waitforservices">waitForServices</a></li>
</ul>
</li>
<li><a href="#the-structure-of-the-configuration-file">The structure of the configuration file</a><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#name">name</a></li>
<li><a href="#needs">needs</a></li>
<li><a href="#requires">requires</a></li>
<li><a href="#hosts">hosts</a></li>
<li><a href="#dockerhosts">dockerHosts</a></li>
<li><a href="#common">common</a></li>
<li><a href="#scripts">scripts</a></li>
<li><a href="#other">other</a></li>
<li><a href="#inheritance">Inheritance</a></li>
</ul>
</li>
<li><a href="#scripts-1">Scripts</a><ul>
<li><a href="#replacement-patterns">Replacement-patterns</a></li>
<li><a href="#internal-commands">Internal commands</a></li>
<li><a href="#task-related-scripts">Task-related scripts</a></li>
<li><a href="#examples">Examples</a></li>
</ul>
</li>
<li><a href="#docker-integration">Docker integration</a></li>
</ul>
<h1 id="installation-of-needed-dependencies">Installation of needed dependencies</h1>
<p>on Mac OS X:</p>
<pre><code>brew install python
pip install fabric
pip install pyyaml
</code></pre>
<p>on Debian/Ubuntu</p>
<pre><code>apt-get install python-pip
pip install fabric
pip install pyyaml
</code></pre>
<p>If you want to use the slack-integration, install slacker, but it's optional.</p>
<pre><code>pip install slacker
</code></pre>
<p>Create a file called "fabfile.yaml" and add your hosts to this file. See this file for more information.</p>
<h1 id="installation-of-fabalicious">Installation of fabalicious</h1>
<p>There are 2 alternative ways to install fabalicious. Because of historic reasons we install fabalicious into the folder <code>_tools/fabalicious</code></p>
<ol>
<li>
<p>Clone this repository, or add this repository as a submodule.</p>
<p><code>shell
mkdir _tools/fabalicious
git submodule add https://github.com/factorial-io/fabalicious.git _tools/fabalicious
ln -s _tools/fabalicious/fabfile.py fabfile.py</code></p>
</li>
<li>
<p>If you are using composer you can add fabalicious as a dependency</p>
<p><code>shell
composer require factorial/fabalicious 2.*
ln -s _tools/fabalicious/fabfile.py fabfile.py</code></p>
</li>
<li>
<p>Run <code>fab --list</code>, this should give you a list of available commands.</p>
</li>
<li>Create a configuration file called <code>fabfile.yaml</code></li>
</ol>
<h1 id="a-simple-configuration-example">A simple configuration-example</h1>
<pre><code class="yaml">name: My awesome project

# We'll need fabalicious &gt;= 2.0
requires: 2.0

# We need git and ssh, there are more options
needs:
  - ssh
  - git

# Our list of host-configurations
hosts:
  dev:
    host: myhost.dev
    user: root
    port: 22
    rootFolder: /var/www
    filesFolder: /var/www
    siteFolder: /var/www
    backupFolder: /var/backups
</code></pre>

<p>For more infos about the file-format have a look at the file-format-section.</p>
<h1 id="running-fabalicious">Running fabalicious</h1>
<p>To execute a task with the help of fabalicious, just</p>
<pre><code class="shell">cd &lt;your-project-folder&gt;
fab config:&lt;your-config-key&gt; &lt;task&gt;
</code></pre>

<p>This will read your fabfile.yaml, look for <code>&lt;your-config-key&gt;</code> in the host-section and run the task <task></p>
<h1 id="tasks">Tasks</h1>
<h2 id="some-background">Some Background</h2>
<p>Fabalicious provides a set of so-called methods which implement all listed functionality. The following methods are available:</p>
<ul>
<li>git</li>
<li>ssh</li>
<li>drush</li>
<li>composer</li>
<li>files</li>
<li>docker</li>
<li>drupalconsole</li>
<li>slack</li>
<li>platform</li>
</ul>
<p>You declare your needs in the fabfile.yaml with the key <code>needs</code>, e.g.</p>
<pre><code class="yaml">needs:
  - git
  - ssh
  - drush
  - files
</code></pre>

<p>Have a look at the file-format documentation for more info.</p>
<h2 id="list-of-available-tasks">List of available tasks</h2>
<p>You can get a list of available commands with</p>
<pre><code class="shell">fab --list
</code></pre>

<h2 id="config">config</h2>
<pre><code class="shell">fab config:&lt;your-config&gt;
</code></pre>

<p>This is one of the most fundamental commands fabalicious provides. This will lookup <code>&lt;your-config&gt;</code> in the <code>hosts</code>-section of your <code>fabfile.yaml</code> and feed the data to <code>fabric</code> so it can connect to the host.</p>
<h2 id="list">list</h2>
<pre><code class="shell">fab list
</code></pre>

<p>This task will list all your hosts defined in your <code>hosts</code>-section of your <code>fabfile.yaml</code>.</p>
<h2 id="about">about</h2>
<pre><code class="shell">fab config:&lt;your-config&gt; about
</code></pre>

<p>will display the configuration of host <code>&lt;your-config&gt;</code>.</p>
<h2 id="blueprint">blueprint</h2>
<pre><code class="shell">fab config:&lt;your-config&gt; blueprint:&lt;branch-name&gt;
fab blueprint:&lt;branch-name&gt;,configName=&lt;config-name&gt;
fab blueprint:&lt;branch-name&gt;,configNmae=&lt;config-name&gt;,output=True
</code></pre>

<p><code>blueprint</code> will try to load a blueprint-template from the fabfile.yaml and apply the input given as <code>&lt;branch-name&gt;</code> to the template. This is helpful if you want to create/ use a new configuration which has some dynamic parts like the name of the database, the name of the docker-container, etc.</p>
<p>The task will look first in the host-config for the property <code>blueprint</code>, afterwards in the dockerHost-configuration <code>&lt;config-name&gt;</code> and eventually in the global namespace. If you wnat to print the generated configuration as yaml, then add <code>,output=true</code> to the command. If not, the generated configuration is used as the current configuration, that means, you can run other tasks against the generated configuration.</p>
<p><strong>Available replacement-patterns</strong> and what they do. Input is <code>feature/XY-123-my_Branch-name</code>, the project-name is <code>Example project</code>:</p>
<ul>
<li><code>%slug.with-hyphens.without-feature%</code> =&gt; <code>xy-123-my-branch-name</code></li>
<li><code>%slug.with-hyphens%</code> =&gt; <code>feature-xy-123-my-branch-name</code></li>
<li><code>%project-slug.with-hypens%</code> =&gt; <code>example-project</code></li>
<li><code>%slug%</code> =&gt; <code>featurexy123mybranchname</code></li>
<li><code>%project-slug%</code> =&gt; <code>exampleproject</code></li>
<li><code>%project-identifier%</code> =&gt; <code>Example project</code></li>
<li><code>%identifier%</code> =&gt; <code>feature/XY-123-my_Branch-name</code></li>
<li><code>%slug.without-feature%</code> =&gt; <code>xy123mybranchname</code></li>
</ul>
<p>Here's an example blueprint:</p>
<pre><code class="yaml">blueprint:
  inheritsFrom: http://some.host/data.yaml
  configName: '%project-slug%-%slug.with-hyphens.without-feature%.some.host.tld'
  branch: '%identifier%'
  database:
    name: '%slug.without-feature%_mysql'
  docker:
    projectFolder: '%project-slug%--%slug.with-hyphens.without-feature%'
    vhost: '%project-slug%-%slug.without-feature%.some.host.tld'
    name: '%project-slug%%slug.without-feature%_web_1'
</code></pre>

<p>And the output of <code>fab blueprint:feature/XY-123-my_Branch-name,configNamy=&lt;config-name&gt;,output=true</code> is</p>
<pre><code class="yaml">hosts:
  phbackend-xy-123-my-branch-name.some.host.tld:
    branch: feature/XY-123-my_Branch-name
    configName: phbackend-xy-123-my-branch-name.some.host.tld
    database:
      name: xy123mybranchname_mysql
    docker:
      name: phbackendxy123mybranchname_web_1
      projectFolder: phbackend--xy-123-my-branch-name
      vhost: phbackend-xy123mybranchname.some.host.tld
    inheritsFrom: http://some.host/data.yaml
</code></pre>

<h2 id="doctor">doctor</h2>
<p>The <code>doctor</code>-task will try to establish all needed ssh-connections and tunnels and give feedback if anything fails. This should be the task you run if you have any problems connecting to a remote instance.</p>
<pre><code class="shell">fab config:&lt;your-config&gt; doctor
fab config:&lt;your-config&gt; doctor:remote=&lt;your-remote-config&gt;
</code></pre>

<p>Running the doctor-task without an argument, will test the connectivity to the configuration <code>&lt;your-cofig&gt;</code>. If you provide a remote configuration with <code>:remote=&lt;your-remote-config&gt;</code> the doctor command will create and test any necessary tunnels to test the connections betwenn <code>&lt;your-config&gt;</code> and <code>&lt;your-remote-config&gt;</code>. Might be handy if the task <code>copyFrom</code> fails.</p>
<h2 id="getproperty">getProperty</h2>
<pre><code class="shell">fab config:&lt;your-config&gt; getProperty:&lt;name-of-property&gt;
</code></pre>

<p>This will print the property-value to the console. Suitable if you want to use fabalicious from within other scripts.</p>
<p><strong>Examples</strong>
<em> <code>fab config:mbb getProperty:host</code> will print the hostname of configuration <code>mbb</code>.
</em> <code>fab config:mbb getProperty:docker/tag</code> will print the tag of the docker-configuration of <code>mbb</code>.</p>
<h2 id="version">version</h2>
<pre><code class="shell">fab config:&lt;your-config&gt; version
</code></pre>

<p>This command will display the installed version of the code on the installation <code>&lt;your-config&gt;</code>.</p>
<p><strong>Available methods</strong>:
* <code>git</code>. The task will get the installed version via <code>git describe</code>, so if you tag your source properly (hint git flow), you'll get a nice version-number.</p>
<p><strong>Configuration:</strong>
* your host-configuration needs a <code>branch</code>-key stating the branch to deploy.</p>
<h2 id="deploy">deploy</h2>
<pre><code class="shell">fab config:&lt;your-config&gt; deploy
fab config:&lt;your-config&gt; deploy:&lt;branch-to-deploy&gt;
</code></pre>

<p>This task will deploy the latest code to the given installation. If the installation-type is not <code>dev</code> or <code>test</code> the <code>backupDB</code>-task is run before the deployment starts. If <code>&lt;branch-to-deploy&gt;</code> is stated the specific branch gets deployed.</p>
<p>After a successfull deployment the <code>reset</code>-taks will be run.</p>
<p><strong>Available methods:</strong>
<em> <code>git</code> will deploy to the latest commit for the given branch defined in the host-configuration. Submodules will be synced, and updated.
</em> <code>platform</code> will push the current branch to the <code>platform</code> remote, which will start the deployment-process on platform.sh</p>
<p><strong>Configuration:</strong>
* your host-configuration needs a <code>branch</code>-key stating the branch to deploy.</p>
<h2 id="reset">reset</h2>
<pre><code class="shell">fab config:&lt;your-config&gt; reset
</code></pre>

<p>This task will reset your installation</p>
<p><strong>Available methods:</strong>
<em> <code>composer</code> will run <code>composer install</code> to update any dependencies before doing the reset
</em> <code>drush</code> will
  * set the site-uuid from fabfile.yaml (drupal 8)
  * revert features (drupal 7) / import the configuration <code>staging</code> (drupal 8),
  * run update-hooks
  * enable a deployment-module if any stated in the fabfile.yaml
  * and does a cache-clear.
  * if your host-type is <code>dev</code> and <code>withPasswordReset</code> is not false, the password gets reset to admin/admin</p>
<p><strong>Configuration:</strong>
<em> your host-configuration needs a <code>branch</code>-key stating the branch to deploy.
</em> your configuration needs a <code>uuid</code>-entry, this is the site uuid (drupal 8). You can get the site-uuid via <code>drush cget system.site</code>
* you can customize which configuration to import with the <code>configurationManagement</code>-setting inside your host- or global-setting.</p>
<p><strong>Examples:</strong>
* <code>fab config:mbb reset:withPasswordReset=0</code> will reset the installation and will not reset the password.</p>
<h2 id="backup">backup</h2>
<pre><code class="shell">fab config:&lt;your-config&gt; backup
</code></pre>

<p>This command will backup your files and database into the specified <code>backup</code>-directory. The file-names will include configuration-name, a timestamp and the git-SHA1. Every backup can be referenced by its filename (w/o extension) or, when git is abailable via the git-commit-hash.</p>
<p><strong>Available methods:</strong>
<em> <code>git</code> will prepend the file-names with a hash of the current revision.
</em> <code>files</code> will tar all files in the <code>filesFolder</code> and save it into the <code>backupFolder</code>
* <code>drush</code> will dump the databases and save it to the <code>backupFolder</code></p>
<p><strong>Configuration:</strong>
* your host-configuration will need a <code>backupFolder</code> and a <code>filesFolder</code></p>
<h2 id="backupdb">backupDB</h2>
<pre><code class="shell">fab config:&lt;your-config&gt; backupDB
</code></pre>

<p>This command will backup only the database. See the task <code>backup</code> for more info.</p>
<h2 id="listbackups">listBackups</h2>
<pre><code class="shell">fab config:&lt;your-config&gt; listBackups
</code></pre>

<p>This command will print all available backups to the console.</p>
<h2 id="restore">restore</h2>
<pre><code class="shell">fab config:&lt;your-config&gt; restore:&lt;commit-hash|file-name&gt;
</code></pre>

<p>This will restore a backup-set. A backup-set consists typically of a database-dump and a gzupped-file-archive. You can a list of candidates via <code>fab config:&lt;config&gt; listBackups</code></p>
<p><strong>Available methods</strong>
<em> <code>git</code> git will checkout the given hash encoded in the filename.
</em> <code>files</code> all files will be restored. An existing files-folder will be renamed for safety reasons.
* <code>drush</code> will import the database-dump.</p>
<h2 id="getbackup">getBackup</h2>
<pre><code class="shell">fab config:&lt;config&gt; getBackup:&lt;commit-hash|file-name&gt;
</code></pre>

<p>This command will copy a remote backup-set to your local computer into the current working-directory.</p>
<p><strong>See also:</strong>
<em> restore
</em> backup</p>
<h2 id="copyfrom">copyFrom</h2>
<pre><code class="shell">fab config:&lt;dest-config&gt; copyFrom:&lt;source-config&gt;
</code></pre>

<p>This task will copy all files via rsync from <code>source-config</code>to <code>dest-config</code> and will dump the database from <code>source-config</code> and restore it to <code>dest-config</code>. After that the <code>reset</code>-task gets executed. This is the ideal task to copy a complete installation from one host to another.</p>
<p><strong>Available methods</strong>
<em> <code>ssh</code> will create all necessary tunnels to access the hosts.
</em> <code>files</code> will rsync all new and changed files from source to dest
* <code>drush</code> will dump the database and restore it on the dest-host.</p>
<h2 id="copydbfrom">copyDBFrom</h2>
<pre><code class="shell">fab config:&lt;dest-config&gt; copyDBFrom:&lt;source-config&gt;
</code></pre>

<p>Basically the same as the <code>copyFrom</code>-task, but only the database gets copied.</p>
<h2 id="copyfilesfrom">copyFilesFrom</h2>
<pre><code class="shell">fab config:&lt;dest-config&gt; copyFileFrom:&lt;source-config&gt;
</code></pre>

<p>Basically the same as the <code>copyFrom</code>-task, but only the new and updated files get copied.</p>
<h2 id="drush">drush</h2>
<pre><code class="shell">fab config:&lt;config&gt; drush:&lt;drush-command&gt;
</code></pre>

<p>This task will execute the <code>drush-command</code> on the remote host specified in <config>. Please note, that you'll have to quote the drush-command when it contains spaces. Signs should be excaped, so python does not interpret them.</p>
<p><strong>Available methods</strong>
* Only available for the <code>drush</code>-method</p>
<p><strong>Examples</strong>
<em> <code>fab config:staging drush:"cc all"</code>
</em> <code>fab config:local drush:fra</code></p>
<h2 id="drupalconsole">drupalconsole</h2>
<p>This task will execute a drupal-console task on the remote host. Please note, that you'll have to quote the command when it contains spaces. There's a special command to install the drupal-console on the host: <code>fab config:&lt;config&gt; drupalconsole:install</code></p>
<p><strong>Available methods</strong>
* Only available for the <code>drupalconsole</code>-method</p>
<p><strong>Examples</strong>
<em> <code>fab config:local drupalconsole:cache:rebuild</code>
</em> <code>fab config:local drupalconsole:"generate:module --module helloworld"</code></p>
<h2 id="getfile">getFile</h2>
<pre><code class="shell">fab config:&lt;config&gt; getFile:&lt;path-to-remote-file&gt;
</code></pre>

<p>Copy a remote file to the current working directory of your current machine.</p>
<h2 id="putfile">putFile</h2>
<pre><code class="shell">fab config:&lt;config&gt; putFile:&lt;path-to-local-file&gt;
</code></pre>

<p>Copy a local file to the tmp-folder of a remote machine.</p>
<p><strong>Configuration</strong>
* this command will use the <code>tmpFolder</code>-host-setting for the destination directory.</p>
<h2 id="getsqldump">getSQLDump</h2>
<pre><code class="shell">fab config:&lt;config&gt; getSQLDump
</code></pre>

<p>Get a current dump of the remote database and copy it to the local machine into the current working directory.</p>
<p><strong>Available methods</strong>
* currently only implemented for the <code>drush</code>-method</p>
<h2 id="restoresqlfromfile">restoreSQLFromFile</h2>
<pre><code class="shell">fab config:&lt;config&gt; restoreSQLFromFile:&lt;path-to-local-sql-dump&gt;
</code></pre>

<p>This command will copy the dump-file <code>path-to-local-sql-dump</code> to the remote machine and import it into the database.</p>
<p><strong>Available methods</strong>
* currently only implemented for the <code>drush</code>-method</p>
<h2 id="script">script</h2>
<pre><code class="shell">fab config:&lt;config&gt; script:&lt;script-name&gt;
</code></pre>

<p>This command will run custom scripts on a remote machine. You can declare scripts globally or per host. If the <code>script-name</code> can't be found in the fabfile.yaml you'll get a list of all available scripts.</p>
<p>Additional arguments get passed to the script. You'll have to use the python-syntax to feed additional arguments to the script. See the examples.</p>
<p><strong>Examples</strong>
<em> <code>fab config:mbb script</code>. List all available scripts for configuration <code>mbb</code>
</em> <code>fab config:mbb script:behat</code> Run the <code>behat</code>-script
* <code>fab config:mbb script:behat,--name="Login feature",--format=pretty</code> Run the behat-test, apply <code>--name</code> and <code>--format</code> parameters to the script</p>
<p>The <code>script</code>-command is rather powerful, have a read about it in the extra section.</p>
<h2 id="docker">docker</h2>
<pre><code class="shell">fab config:&lt;config&gt; docker:&lt;docker-task&gt;
</code></pre>

<p>The docker command is suitable for orchestrating and administering remote instances of docker-containers. The basic setup is that your host-configuration has a <code>docker</code>-section, which contains a <code>configuration</code>-key. The <code>dockerHosts</code>-section of your fabfile.yaml has a list of tasks which are executed on the "parent-host" of the configuration. Please have a look at the docker-section for more information.</p>
<p>Most of the time the docker-container do not have a public or known ip-address. Fabalicious tries to find out the ip-address of a given instance and use that for communicating with its services.</p>
<p>There are three implicit tasks available:</p>
<h3 id="copysshkeys">copySSHKeys</h3>
<pre><code class="shell">fab config:mbb docker:copySSHKeys
</code></pre>

<p>This will copy the ssh-keys into the docker-instance. You'll need to provide the paths to the files via the three configurations:
<em> <code>dockerKeyFile</code>, the path to the private ssh-key to use.
</em> <code>dockerAuthorizedKeyFile</code>, the path to the file for <code>authoried_keys</code>
* <code>dockerKnownHostsFile</code>, the path to the file for <code>known_hosts</code></p>
<p>As docker-container do not have any state, this task is used to copy any necessary ssh-configuration into the docker-container, so communication per ssh does not need any passwords.</p>
<h3 id="startremoteaccess">startRemoteAccess</h3>
<pre><code class="shell">fab config:&lt;config&gt; docker:startRemoteAccess
fab config:&lt;config&gt; docker:startRemoteAccess,port=&lt;port&gt;,publicPort=&lt;public-port&gt;
</code></pre>

<p>This docker-task will run a ssh-command to forward a local port to a port inside the docker-container. It starts a new ssh-session which will do the forwarding. When finished, type <code>exit</code>.</p>
<p><strong>Examples</strong>
<em> <code>fab config:mbb docker:startRemoteAccess</code> will forward <code>localhost:8888</code> to port <code>80</code> of the docker-container
</em> <code>fab config:mbb docker:startRemoteAccess,port=3306,publicPort=33060</code> will forward <code>localhost:33060</code>to port <code>3306</code> of the docker-container</p>
<h3 id="waitforservices">waitForServices</h3>
<p>This task will try to establish a ssh-connection into the docker-container and if the connection succeeds, waits for <code>supervisorctl status</code> to return success. This is useful in scripts to wait for any services that need some time to start up. Obviously this task depends on <code>supervisorctl</code>.</p>
<h1 id="the-structure-of-the-configuration-file">the structure of the configuration file</h1>
<h2 id="overview">Overview</h2>
<p>The configuration is fetched from the file <code>fabfile.yaml</code> and should have the followin structure:</p>
<pre><code class="yaml">name: &lt;the project name&gt;

needs:
  - list of methods

requires: 2.0

dockerHosts:
  docker1:
    ...

hosts:
  host1:
    ...
</code></pre>

<p>Here's the documentation of the supported and used keys:</p>
<h3 id="name">name</h3>
<p>The name of the project, it's only used for output.</p>
<h3 id="needs">needs</h3>
<p>List here all needed methods for that type of project. Available methods are:
  * <code>git</code> for deployments via git
  * <code>ssh</code>
  * <code>drush7</code> for support of drupal-7 installations
  * <code>drush8</code> for support fo drupal 8 installations
  * <code>files</code>
  * <code>slack</code> for slack-notifications
  * <code>docker</code> for docker-support
  * <code>composer</code> for composer support
  * <code>drupalconsole</code> for drupal-concole support</p>
<p><strong>Example for drupal 7</strong></p>
<pre><code class="yaml">needs:
  - ssh
  - git
  - drush7
  - files
</code></pre>

<p><strong>Example for drupal 8 composer based and dockerized</strong></p>
<pre><code class="yaml">needs:
  - ssh
  - git
  - drush8
  - composer
  - docker
  - files
</code></pre>

<h3 id="requires">requires</h3>
<p>The file-format of fabalicious changed over time. Set this to the lowest version of fabalicious which can handle the file. Should bei <code>2.0</code></p>
<h3 id="hosts">hosts</h3>
<p>Hosts is a list of host-definitions which contain all needed data to connect to a remote host. Here's an example</p>
<pre><code class="yaml">hosts:
  exampleHost:
    host: example.host.tld
    user: example_user
    port: 2233
    password: optionalPassword
    type: dev
    rootFolder: /var/www/public
    gitRootFolder: /var/www
    siteFolder: /sites/default
    filesFolder: /sites/default/files
    backupFolder: /var/www/backups
    supportsInstalls: true|false
    supportsCopyFrom: true|false
    type: dev
    branch: develop
    docker:
      ...
    database:
      ...
    scripts:
      ...
    sshTunnel:
      ..

</code></pre>

<p>You can get all host-information including the default values using the fabalicious command <code>about</code>:</p>
<pre><code class="shell">fab config:staging about
</code></pre>

<p>This will print all host configuration for the host <code>staging</code>.</p>
<p>Here are all possible keys documented:</p>
<ul>
<li><code>host</code>, <code>user</code>, <code>port</code> and optionally <code>password</code> is used to connect via SSH to the remote machine. Please make sure SSH key forwarding is enabled on your installation. <code>password</code> should only used as an exception.</li>
<li><code>type</code> defines the type of installation. Currently there are four types available:<ul>
<li><code>dev</code> for dev-installations, they won't backup the databases on deployment</li>
<li><code>test</code> for test-installations, similar than <code>dev</code>, no backups on deployments</li>
<li><code>stage</code> for staging-installations.</li>
<li><code>live</code> for live-installations. Some tasks can not be run on live-installations as <code>install</code> or as a target for <code>copyFrom</code>
The main use-case is to run different scripts per type, see the <code>common</code>-section.</li>
</ul>
</li>
<li><code>branch</code> the name of the branch to use for deployments, they get ususally checked out and pulled from origin. <code>gitRootFolder</code> should be the base-folder, where the local git-repository is. (If not explicitely set, fabalicious uses the <code>rootFolder</code>)</li>
<li><code>rootFolder</code>  the web-root-folder of the installation, typically exposed to the public.</li>
<li><code>backupFolder</code> the folder, where fabalicious should store its backups into</li>
<li><code>runLocally</code> if set to true, all commands are run on the local host, not on a remote host. Good for local development on linux or tools like MAMP.</li>
<li><code>siteFolder</code> is a drupal-specific folder, where the settings.php resides for the given installation. This allows to interact with multisites etc.</li>
<li><code>filesFolder</code> the path to the files-folder, where user-assets get stored and which should be backed up by the <code>files</code>-method</li>
<li><code>tmpFolder</code> name of tmp-folder, defaults to <code>/tmp</code></li>
<li><code>supportsBackups</code> defaults to true, set to false, if backups are not supported</li>
<li><code>supportsZippedBackups</code> defaults to true. Set to false, if database-dumps shouldn't be zipped.</li>
<li><code>supportsInstalls</code> defaults to false, if set to true, the <code>install</code>-task will run on that host.</li>
<li><code>supportsCopyFrom</code> defaults to false, if set to true, the host can be used as target for <code>copyFrom</code></li>
<li><code>ignoreSubmodules</code> defaults to true, set to false, if you don't want to update a projects' submodule on deploy.</li>
<li><code>configurationManagement</code>, an array of configuration-labels to import on <code>reset</code>, defaults to <code>['staging']</code>. You can add command arguments for drush, e.g. <code>['staging', 'dev --partial']</code></li>
<li><code>disableKnownHosts</code>, <code>useShell</code> and <code>usePty</code> see section <code>other</code></li>
<li><code>database</code> the database-credentials the <code>install</code>-tasks uses when installing a new installation.<ul>
<li><code>name</code> the database name</li>
<li><code>host</code> the database host</li>
<li><code>user</code> the database user</li>
<li><code>pass</code> the password for the database user</li>
<li><code>prefix</code> the optional table-prefix to use</li>
</ul>
</li>
<li><code>sshTunnel</code> Fabalicious supports SSH-Tunnels, that means it can log in into another machine and forward the access to the real host. This is handy for dockerized installations, where the ssh-port of the docker-instance is not public. <code>sshTunnel</code> needs the following informations<ul>
<li><code>bridgeHost</code>: the host acting as a bridge.</li>
<li><code>bridgeUser</code>: the ssh-user on the bridge-host</li>
<li><code>bridgePort</code>: the port to connect to on the bridge-host</li>
<li><code>localPort</code>: the local port which gets forwarded to the <code>destPort</code>. If <code>localPort</code> is omitted, the ssh-port of the host-configuration is used. If the host-configuration does not have a port-property a random port is used.</li>
<li><code>destHost</code>: the destination host to forward to</li>
<li><code>destHostFromDockerContainer</code>: if set, the docker's Ip address is used for destHost. This is automatically set when using a <code>docker</code>-configuration, see there.</li>
<li><code>destPort</code>: the destination port to forward to</li>
</ul>
</li>
<li><code>docker</code> for all docker-relevant configuration. <code>configuration</code> and <code>name</code> are the only required keys, all other are optional and used by the docker-tasks.<ul>
<li><code>configuration</code> should contain the key of the dockerHost-configuration in <code>dockerHosts</code></li>
<li><code>name</code> contains the name of the docker-container. This is needed to get the IP-address of the particular docker-container when using ssh-tunnels (see above).</li>
</ul>
</li>
</ul>
<h3 id="dockerhosts">dockerHosts</h3>
<p><code>dockerHosts</code> is similar structured as the <code>hosts</code>-entry. It's a keyed lists of hosts containing all necessary information to create a ssh-connection to the host, controlling the docker-instances, and a list of tasks, the user might call via the <code>docker</code>-command. See the <code>docker</code>-entry for a more birds-eye-view of the concepts.</p>
<p>Here's an example <code>dockerHosts</code>-entry:</p>
<pre><code class="yaml">dockerHosts:
  mbb:
    runLocally: false
    host: multibasebox.dev
    user: vagrant
    password: vagrant
    port: 22
    rootFolder: /vagrant
    environment:
      VHOST: %host.host%
      WEBROOT: %host.rootFolder%
    tasks:
      logs:
        - docker logs %host.docker.name%
</code></pre>

<p>Here's a list of all possible entries of a dockerHosts-entry:</p>
<ul>
<li><code>runLocally</code>: if this is set to <code>true</code>, all docker-scripts are run locally, and not on a remote host.</li>
<li><code>host</code>, <code>user</code>, <code>port</code> and <code>password</code>: all needed information to start a ssh-connection to that host. These settings are only respected, if <code>runLocally</code> is set to <code>false</code>. <code>port</code> and <code>password</code> are optional.</li>
<li><code>environment</code> a keyed list of environment-variables to set, when running one of the tasks. The replacement-patterns of <code>scripts</code> are supported, see there for more information.</li>
<li><code>tasks</code> a keyed list of commands to run for a given docker-subtask (similar to <code>scripts</code>). Note: these commands are running on the docker-host, not on the host. All replacement-patterns do work, and you can call even other tasks via <code>execute(&lt;task&gt;, &lt;subtask&gt;)</code> e.g. <code>execute(docker, stop)</code> See the <code>scripts</code>-section for more info.</li>
</ul>
<p>You can use <code>inheritsFrom</code> to base your configuration on an existing one. You can add any configuration you may need and reference to that information from within your tasks via the replacement-pattern <code>%dockerHost.keyName%</code> e.g. <code>%dockerHost.host%</code>.</p>
<p>You can reference a specific docker-host-configuration from your host-configuration via</p>
<pre><code class="yaml">hosts:
  test:
    docker:
      configuration: mbb
</code></pre>

<h3 id="common">common</h3>
<p>common contains a list of commands, keyed by task and type which gets executed when the task is executed.</p>
<p>Example:</p>
<pre><code class="yaml">common:
  reset:
    dev:
      - echo &quot;running reset on a dev-instance&quot;
    stage:
      - echo &quot;running reset on a stage-instance&quot;
    prod:
      - echo &quot;running reset on a prod-instance&quot;
  deployPrepare:
    dev:
      - echo &quot;preparing deploy on a dev instance&quot;
  deploy:
    dev:
      - echo &quot;deploying on a dev instance&quot;
  deployFinished:
    dev:
      - echo &quot;finished deployment on a dev instance&quot;
</code></pre>

<p>The first key is the task-name (<code>reset</code>, <code>deploy</code>, ...), the second key is the type of the installation (<code>dev</code>, <code>stage</code>, <code>prod</code>, <code>test</code>). Every task is prepended by a prepare-stage and appended by a finished-stage, so you can call scripts before and after an actual task. You can even run other scripts via the <code>execute</code>-command, see the <code>scripts</code>-section.</p>
<h3 id="scripts">scripts</h3>
<p>A keyed list of available scripts. This scripts may be defined globally (on the root level) or on a per host-level. The key is the name of the script and can be executed via</p>
<pre><code class="shell">fab config:&lt;configuration&gt; script:&lt;key&gt;
</code></pre>

<p>A script consists of an array of commands which gets executed sequentially.</p>
<p>An example:</p>
<pre><code class="yaml">scripts:
  test:
    - echo &quot;Running script test&quot;
  test2:
    - echo &quot;Running script test2 on %host.config_name%
    - execute(script, test)
</code></pre>

<p>Scripts can be defined on a global level, but also on a per host-level.</p>
<p>You can declare default-values for arguments via a slightly modified syntax:</p>
<pre><code class="yaml">scripts:
  defaultArgumentTest:
    defaults:
      name: Bob
    script:
      - echo &quot;Hello %arguments.name%&quot;
</code></pre>

<p>Running the script via <code>fab config:mbb script:defaultArgumentTest,name="Julia"</code> will show <code>Hello Julia</code>. Running <code>fab config:mbb script:defaultArgumentTest</code> will show <code>Hello Bob</code>.</p>
<p>For more information see the main scripts section below.</p>
<h3 id="other">other</h3>
<ul>
<li><code>deploymentModule</code> name of the deployment-module the drush-method enables when doing a deploy</li>
<li><code>usePty</code> defaults to true, set it to false when you can't connect to specific hosts.</li>
<li><code>useShell</code> defaults to true, set it to false, when you can't connect to specific hosts.</li>
<li><code>disableKnownHosts</code> defaults to false, set it too true, if you trust every host</li>
<li><code>gitOptions</code> a keyed list of options to apply to a git command. Currently only pull is supported. If your git-version does not support <code>--rebase</code> you can disable it via an empty array: <code>pull: []</code></li>
<li><code>sqlSkipTables</code> a list of table-names drush should omit when doing a backup.</li>
<li><code>configurationManagement</code> a list of configuration-labels to import on <code>reset</code>. This defaults to <code>['staging']</code> and may be overridden on a per-host basis. You can add command arguments to the the configuration label.</li>
</ul>
<p>Example:</p>
<pre><code class="yaml">deploymentModule: my_deployment_module
usePty: false
useShell: false
gitOptions:
  pull:
    - --rebase
    - --quiet
sqlSkipTables:
  - cache
  - watchdog
  - session
configurationManagement:
   - staging
   - dev -- partial
</code></pre>

<h2 id="inheritance">Inheritance</h2>
<p>Sometimes it make sense to extend an existing configuration or to include configuration from other places from the file-system or from remote locations. There's a special key <code>inheritsFrom</code> which will include the yaml found at the location and merge it with the data. This is supported for entries in <code>hosts</code> and <code>dockerHosts</code> and for the fabfile itself.</p>
<p>If a <code>host</code>, a <code>dockerHost</code> or the fabfile itself has the key <code>inheritsFrom</code>, then the given key is used as a base-configuration. Here's a simple example:</p>
<pre><code class="yaml">hosts:
  default:
    port: 22
    host: localhost
    user: default
  example1:
    inheritsFrom: default
    port: 23
  example2:
    inheritsFrom: example1
    user: example2
</code></pre>

<p><code>example1</code> will store the merged configuration from <code>default</code> with the configuration of <code>example1</code>. <code>example2</code> is a merge of all three configurations: <code>example2</code> with <code>example1</code> with <code>default</code>.</p>
<pre><code class="yaml">hosts:
  example1:
    port: 23
    host: localhost
    user: default
  example2:
    port: 23
    host: localhost
    user: example2
</code></pre>

<p>You can even reference external files to inherit from:</p>
<pre><code class="yaml">hosts:
  fileExample:
    inheritsFrom: ./path/to/config/file.yaml
  httpExapme:
    inheritsFrom: http://my.tld/path/to/config_file.yaml
</code></pre>

<p>This mechanism works also for the fabfile.yaml / index.yaml itself, and is not limited to one entry:</p>
<pre><code class="yaml">name: test fabfile

inheritsFrom:
  - ./mbb.yaml
  - ./drupal.yaml
</code></pre>

<h1 id="scripts_1">Scripts</h1>
<p>Scripts are a powerful concept of fabalicious. There are a lot of places where scripts can be called. The <code>common</code>-section defines common scripts to be run for specific task/installation-type-configurations, docker-tasks are also scripts which you can execute via the docker-command. And you can even script fabalicious tasks and create meta-tasks.</p>
<p>A script is basically a list of commands which get executed via shell on a remote machine. To stay independent of the host where the script is executed, fabalicious parsed the script before executing it and replaces given variables with their counterpart in the yams file.</p>
<h2 id="replacement-patterns">Replacement-patterns</h2>
<p>Replacement-Patterns are specific strings enclosed in <code>%</code>s, e.g. <code>%host.port%</code>, <code>%dockerHost.rootFolder% or</code>%arguments.name%.</p>
<p>Here's a simple example;</p>
<pre><code class="yaml">script:
  test:
    - echo &quot;I am running on %host.config_name%&quot;
</code></pre>

<p>Calling this script via</p>
<pre><code class="shell">fab config:mbb script:test
</code></pre>

<p>will show <code>I am running on mbb</code>.</p>
<ul>
<li>The host-configuration gets exposes via the <code>host.</code>-prefix, so <code>port</code> maps to <code>%host.port%</code>, etc.</li>
<li>The dockerHost-configuration gets exposed via the <code>dockerHost</code>-prefix, so <code>rootFolder</code> maps to <code>%dockerHost.rootFolder%</code></li>
<li>The global configuration of the yams-file gets exposed to the <code>settings</code>-prefix, so <code>uuid</code> gets mapped to `%settings.uuid%</li>
<li>Optional arguments to the <code>script</code>-taks get the <code>argument</code>-prefix, e.g. <code>%arguments.name%</code>. You can get all arguments via <code>%arguments.combined%</code>.</li>
<li>You can access hierarchical information via the dot-operator, e.g. <code>%host.database.name%</code></li>
</ul>
<p>If fabalicious detects a pattern it can't replace it will abort the execution of the script and displays a list of available replacement-patterns.</p>
<h2 id="internal-commands">Internal commands</h2>
<p>There are currently 3 internal commands. These commands control the flow inside fabalicious:</p>
<ul>
<li><code>fail_on_error(1|0)</code> If fail_on_error is set to one, fabalicious will exit if one of the script commands returns a non-zero return-code. When using <code>fail_on_error(0)</code> only a warning is displayed, the script will continue.</li>
<li><code>execute(task, subtask, arguments)</code> execute a fabalicious task. For example you can run a deployment from a script via <code>execute(deploy)</code> or stop a docker-container from a script via <code>execute(docker, stop)</code></li>
<li><code>fail_on_missing_directory(directory, message)</code> will print message <code>message</code> if the directory <code>directory</code> does not exist.</li>
</ul>
<h2 id="task-related-scripts">Task-related scripts</h2>
<p>You can add scripts to the <code>common</code>-section, which will called for any host. You can differentiate by task-name and host-type, e.g. create a script which gets called for the task <code>deploy</code> and type <code>dev</code>.</p>
<p>You can even run scripts before or after a task is executed. Append the task with <code>Prepare</code> or <code>Finished</code>.</p>
<p>You can even run scripts for specific tasks and hosts. Just add your script with the task-name as its key.</p>
<pre><code class="yaml">host:
  test:
    deployPrepare:
      - echo &quot;Preparing deploy for test&quot;
    deploy:
      - echo &quot;Deploying on test&quot;
    deployFinished:
      - echo &quot;Deployment finished for test&quot;
</code></pre>

<p>These scripts in the above examples gets executed only for the host <code>test</code> and task <code>deploy</code>.</p>
<h2 id="examples">Examples</h2>
<p>A rather complex example scripting fabalicious.</p>
<pre><code class="yaml">scripts:
  runTests:
    defaults:
      branch: develop
    script:
      - execute(docker, start)
      - execute(docker, waitForServices)
      - execute(deploy, %arguments.branch%)
      - execute(script, behatInstall)
      - execute(script, behat, --profile=ci --format=junit --format=progress)
      - execute(getFile, /var/www/_tools/behat/build/behat/default.xml, ./_tools/behat)
      - execute(docker, stop)
</code></pre>

<p>This script will
<em> start the docker-container,
</em> wait for it,
<em> deploys the given branch,
</em> run a script which will install behat,
<em> run behat with some custom arguments,
</em> gets the result-file and copy it to a location,
* and finally stops the container.</p>
<h1 id="docker-integration">Docker integration</h1>
<p>TODO</p>
<h1 id="local-overrides">Local overrides</h1>
<p><code>fabfile.local.yaml</code> is used to override parts of your fabfile-configuration. If you run a fab-command the code will try to find the <code>fabfile.local.yaml</code> up to three folder levels up and merge the data with your fabfile.yaml.</p>
<p>A small example:</p>
<pre><code>fabfile.local.yaml
+ project
  fabfile.yaml
</code></pre>

<p>Contents fo fabfile.yaml</p>
<pre><code class="yaml">hosts:
  local:
    host: multibasebox.dev
    port: 22
    [...]
</code></pre>

<p>Contents of fabfile.local.yaml:</p>
<pre><code class="yaml">hosts:
  local:
    host: localhost
    port: 2222
</code></pre>

<p>This will override the <code>host</code> and <code>port</code> settings of the <code>local</code>-configuration. With this technique you can alter an existing fabfile.yaml with local overrides. (In this example,  <code>host=localhost</code> and <code>port=2222</code></p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p> 2017 Factorial GmbH, Hamburg</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/factorial-io/fabalicious/" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
    </span>
</div>
    <script src="./js/theme.js"></script>

</body>
</html>

<!--
MkDocs version : 0.16.1
Build Date UTC : 2017-02-05 23:05:55
-->
